# IT運用システム 操作手順書

## 目次

1. [システム概要](#システム概要)
2. [前提条件](#前提条件)
3. [サーバー起動方法](#サーバー起動方法)
   - [自動起動（推奨）](#自動起動推奨)
   - [手動起動](#手動起動)
4. [アクセス方法](#アクセス方法)
5. [ログイン認証](#ログイン認証)
   - [一般ユーザーログイン](#一般ユーザーログイン)
   - [管理者ログイン](#管理者ログイン)
6. [基本操作](#基本操作)
7. [トラブルシューティング](#トラブルシューティング)
8. [参考資料](#参考資料)

## システム概要

IT運用システムは、Graph APIパーミッション管理、システムモニタリング、セキュリティアラート管理などの機能を提供するWebUIベースのアプリケーションです。このシステムは、ISO 20000（ITサービスマネジメント）およびISO 27001（情報セキュリティマネジメント）の要件に準拠して設計されています。

## 前提条件

- Node.js v18.x以上がインストールされていること
- npmが利用可能であること
- MongoDBがインストールされ、実行されていること
- Redisがインストールされ、実行されていること（オプション：キャッシュ機能を使用する場合）
- ウェブブラウザ（Chrome, Firefox, Edge最新版推奨）

## サーバー起動方法

### 自動起動（推奨）

システムには、バックエンドとフロントエンドの両方のサーバーを自動的に起動するPowerShellスクリプトが用意されています。

1. PowerShellを管理者権限で起動
2. プロジェクトのルートディレクトリに移動
   ```powershell
   cd path\to\it-ops-system
   ```
3. 起動スクリプトを実行
   ```powershell
   .\start-servers.ps1
   ```

スクリプトは以下の処理を自動的に行います：
- 既存のNode.jsプロセスの終了
- ポート3000と3002の解放
- バックエンドサーバーの起動（http://localhost:3002）
- フロントエンドサーバーの起動（http://localhost:3000）
- ブラウザでフロントエンドへの自動アクセス

### 手動起動

自動起動スクリプトが使用できない場合は、以下の手順で手動起動が可能です。

#### バックエンドの起動

1. コマンドプロンプトまたはPowerShellを開く
2. バックエンドディレクトリに移動
   ```bash
   cd path\to\it-ops-system\backend
   ```
3. 依存パッケージがインストールされていない場合はインストール
   ```bash
   npm install
   ```
4. 開発サーバーを起動
   ```bash
   npm run dev
   ```
5. サーバーが http://localhost:3002 で起動し、API エンドポイントは http://localhost:3002/api/ で利用可能になります

#### フロントエンドの起動

1. 別のコマンドプロンプトまたはPowerShellを開く
2. フロントエンドディレクトリに移動
   ```bash
   cd path\to\it-ops-system\frontend
   ```
3. 依存パッケージがインストールされていない場合はインストール
   ```bash
   npm install
   ```
4. 開発サーバーを起動
   ```bash
   npm run dev
   ```
5. サーバーが http://localhost:3000 で起動します

## アクセス方法

システムへのアクセスは、Webブラウザを使用して行います。

1. ブラウザ（Chrome, Firefox, Edge最新版推奨）を起動
2. アドレスバーに以下のURLを入力
   ```
   http://localhost:3000
   ```
3. ログイン画面が表示されます

## ログイン認証

### 一般ユーザーログイン

1. ログイン画面で認証情報を入力
   - ユーザー名: [ユーザーのメールアドレスまたはユーザーID]
   - パスワード: [ユーザーのパスワード]
2. 必要に応じて多要素認証を完了
3. ログイン後、IT運用情報ダッシュボードが表示されます

テスト用アカウント（開発環境のみ）:
- ユーザー名: testuser
- パスワード: password123

### 管理者ログイン

1. ログイン画面で管理者アカウントの認証情報を入力
   - ユーザー名: [管理者のメールアドレスまたはユーザーID]
   - パスワード: [管理者のパスワード]
2. 必要に応じて多要素認証を完了
3. ログイン後、管理者ダッシュボードが表示されます

管理者アカウントには以下の前提条件があります：
- グローバル管理者権限を持つアカウント
- Microsoft 365管理者アカウント（Graph API連携用）

## 基本操作

### 一般ユーザーダッシュボード

ログイン後、IT運用情報ダッシュボードが表示されます。ダッシュボードには以下の主要セクションがあります：

- **概要**: システム全体の状態と重要な指標
- **マイパーミッション**: 自分のGraph APIパーミッション
- **システムステータス**: システムリソースとアラート
- **セキュリティアラート**: セキュリティ関連の警告
- **通知**: リアルタイム通知

### 管理者ダッシュボード

管理者としてログインすると、管理者ダッシュボードが表示されます。ダッシュボードには以下の主要セクションがあります：

- **概要**: システム全体の状態と重要な指標
- **パーミッション管理**: Graph APIパーミッション管理機能
- **ユーザー管理**: ユーザーアカウント管理
- **システムステータス**: システムリソースとアラート
- **監査ログ**: 操作履歴と監査情報

## トラブルシューティング

### よくある問題と解決方法

1. **サーバーが起動しない**
   - Node.jsのバージョンが18.x以上であることを確認
   - 必要なポート（3000, 3002）が他のプロセスで使用されていないことを確認
   - ログファイル（backend/logs/）を確認

2. **ログインできない**
   - ユーザー名とパスワードが正しいことを確認
   - Active Directory連携が正しく設定されていることを確認
   - バックエンドサーバーが起動していることを確認

3. **CORS エラー**
   - バックエンドの .env ファイルで CORS_ORIGIN が正しく設定されているか確認
   - フロントエンドの API_URL が正しく設定されているか確認

4. **データベース接続エラー**
   - MongoDB が起動していることを確認
   - 接続文字列が正しいことを確認

5. **認証エラー**
   - JWT_SECRET が正しく設定されているか確認
   - トークンが正しく生成・送信されているか確認

### ログの確認方法

1. **バックエンドログ**
   - console.log 出力を確認
   - logs/ ディレクトリ内のログファイルを確認

2. **フロントエンドログ**
   - ブラウザの開発者ツール > Console タブで確認

## システムの停止方法

1. **フロントエンドの停止**
   - ターミナルで Ctrl+C を押下

2. **バックエンドの停止**
   - ターミナルで Ctrl+C を押下

3. **自動起動スクリプトで起動した場合**
   - スクリプトのターミナルで Ctrl+C を押下
   - または、スクリプトのウィンドウを閉じる

## 参考資料

詳細な情報については、以下のドキュメントを参照してください：

- [実行手順書](03_実装/it-ops-system/EXECUTION_MANUAL.md) - システムの実行に関する詳細情報
- [運用・保守マニュアル](03_実装/it-ops-system/OPERATIONS.md) - システムの運用と保守に関する情報
- [ユーザーガイド](03_実装/it-ops-system/docs/user/user-guide.md) - 一般ユーザー向けの詳細な使用方法
- [管理者マニュアル](03_実装/it-ops-system/docs/user/admin-manual.md) - 管理者向けの詳細な使用方法
- [セキュリティ実装の手動設定マニュアル](03_実装/it-ops-system/MANUAL_SETUP.md) - セキュリティ設定に関する詳細情報
- [トラブルシューティングガイド](03_実装/it-ops-system/docs/user/troubleshooting-guide.md) - 問題解決のための詳細ガイド