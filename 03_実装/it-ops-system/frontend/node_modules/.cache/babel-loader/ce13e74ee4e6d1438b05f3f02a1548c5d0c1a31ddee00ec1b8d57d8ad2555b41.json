{"ast":null,"code":"import{useState,useEffect}from'react';import{useNavigate}from'react-router-dom';import{Alert,CircularProgress,Container,Typography}from'@mui/material';import{useAuth}from'../contexts/AuthContext';import{authApi}from'../services/api';import{jsx as _jsx,Fragment as _Fragment}from\"react/jsx-runtime\";export const PermissionCheck=_ref=>{let{resource,action,children}=_ref;const{user}=useAuth();const navigate=useNavigate();const[hasPermission,setHasPermission]=useState(null);const[error,setError]=useState(null);useEffect(()=>{const checkPermission=async()=>{try{if(!(user!==null&&user!==void 0&&user.email)){navigate('/login');return;}const allowed=await authApi.checkPermission({userEmail:user.email,check:{resource,action}});setHasPermission(allowed);if(!allowed){setError(`${resource}への${action}権限がありません`);}}catch(err){setError('権限の確認中にエラーが発生しました');setHasPermission(false);}};checkPermission();},[user,resource,action,navigate]);if(hasPermission===null){return/*#__PURE__*/_jsx(Container,{sx:{display:'flex',justifyContent:'center',mt:4},children:/*#__PURE__*/_jsx(CircularProgress,{})});}if(error){return/*#__PURE__*/_jsx(Container,{sx:{mt:4},children:/*#__PURE__*/_jsx(Alert,{severity:\"error\",children:/*#__PURE__*/_jsx(Typography,{children:error})})});}return hasPermission?/*#__PURE__*/_jsx(_Fragment,{children:children}):null;};","map":{"version":3,"names":["useState","useEffect","useNavigate","Alert","CircularProgress","Container","Typography","useAuth","authApi","jsx","_jsx","Fragment","_Fragment","PermissionCheck","_ref","resource","action","children","user","navigate","hasPermission","setHasPermission","error","setError","checkPermission","email","allowed","userEmail","check","err","sx","display","justifyContent","mt","severity"],"sources":["E:/IT運用システム/03_実装/it-ops-system/frontend/src/components/PermissionCheck.tsx"],"sourcesContent":["import { useState, useEffect } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { Alert, CircularProgress, Container, Typography } from '@mui/material';\r\nimport { useAuth } from '../contexts/AuthContext';\r\nimport { authApi } from '../services/api';\r\n\r\ninterface PermissionCheckProps {\r\n  resource: string;\r\n  action: 'read' | 'write';\r\n  children: React.ReactNode;\r\n}\r\n\r\nexport const PermissionCheck: React.FC<PermissionCheckProps> = ({ \r\n  resource,\r\n  action,\r\n  children \r\n}) => {\r\n  const { user } = useAuth();\r\n  const navigate = useNavigate();\r\n  const [hasPermission, setHasPermission] = useState<boolean | null>(null);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  useEffect(() => {\r\n    const checkPermission = async () => {\r\n      try {\r\n        if (!user?.email) {\r\n          navigate('/login');\r\n          return;\r\n        }\r\n\r\n        const allowed = await authApi.checkPermission({\r\n          userEmail: user.email,\r\n          check: { resource, action }\r\n        });\r\n\r\n        setHasPermission(allowed);\r\n        if (!allowed) {\r\n          setError(`${resource}への${action}権限がありません`);\r\n        }\r\n      } catch (err) {\r\n        setError('権限の確認中にエラーが発生しました');\r\n        setHasPermission(false);\r\n      }\r\n    };\r\n\r\n    checkPermission();\r\n  }, [user, resource, action, navigate]);\r\n\r\n  if (hasPermission === null) {\r\n    return (\r\n      <Container sx={{ display: 'flex', justifyContent: 'center', mt: 4 }}>\r\n        <CircularProgress />\r\n      </Container>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <Container sx={{ mt: 4 }}>\r\n        <Alert severity=\"error\">\r\n          <Typography>{error}</Typography>\r\n        </Alert>\r\n      </Container>\r\n    );\r\n  }\r\n\r\n  return hasPermission ? <>{children}</> : null;\r\n};"],"mappings":"AAAA,OAASA,QAAQ,CAAEC,SAAS,KAAQ,OAAO,CAC3C,OAASC,WAAW,KAAQ,kBAAkB,CAC9C,OAASC,KAAK,CAAEC,gBAAgB,CAAEC,SAAS,CAAEC,UAAU,KAAQ,eAAe,CAC9E,OAASC,OAAO,KAAQ,yBAAyB,CACjD,OAASC,OAAO,KAAQ,iBAAiB,CAAC,OAAAC,GAAA,IAAAC,IAAA,CAAAC,QAAA,IAAAC,SAAA,yBAQ1C,MAAO,MAAM,CAAAC,eAA+C,CAAGC,IAAA,EAIzD,IAJ0D,CAC9DC,QAAQ,CACRC,MAAM,CACNC,QACF,CAAC,CAAAH,IAAA,CACC,KAAM,CAAEI,IAAK,CAAC,CAAGX,OAAO,CAAC,CAAC,CAC1B,KAAM,CAAAY,QAAQ,CAAGjB,WAAW,CAAC,CAAC,CAC9B,KAAM,CAACkB,aAAa,CAAEC,gBAAgB,CAAC,CAAGrB,QAAQ,CAAiB,IAAI,CAAC,CACxE,KAAM,CAACsB,KAAK,CAAEC,QAAQ,CAAC,CAAGvB,QAAQ,CAAgB,IAAI,CAAC,CAEvDC,SAAS,CAAC,IAAM,CACd,KAAM,CAAAuB,eAAe,CAAG,KAAAA,CAAA,GAAY,CAClC,GAAI,CACF,GAAI,EAACN,IAAI,SAAJA,IAAI,WAAJA,IAAI,CAAEO,KAAK,EAAE,CAChBN,QAAQ,CAAC,QAAQ,CAAC,CAClB,OACF,CAEA,KAAM,CAAAO,OAAO,CAAG,KAAM,CAAAlB,OAAO,CAACgB,eAAe,CAAC,CAC5CG,SAAS,CAAET,IAAI,CAACO,KAAK,CACrBG,KAAK,CAAE,CAAEb,QAAQ,CAAEC,MAAO,CAC5B,CAAC,CAAC,CAEFK,gBAAgB,CAACK,OAAO,CAAC,CACzB,GAAI,CAACA,OAAO,CAAE,CACZH,QAAQ,CAAC,GAAGR,QAAQ,KAAKC,MAAM,UAAU,CAAC,CAC5C,CACF,CAAE,MAAOa,GAAG,CAAE,CACZN,QAAQ,CAAC,mBAAmB,CAAC,CAC7BF,gBAAgB,CAAC,KAAK,CAAC,CACzB,CACF,CAAC,CAEDG,eAAe,CAAC,CAAC,CACnB,CAAC,CAAE,CAACN,IAAI,CAAEH,QAAQ,CAAEC,MAAM,CAAEG,QAAQ,CAAC,CAAC,CAEtC,GAAIC,aAAa,GAAK,IAAI,CAAE,CAC1B,mBACEV,IAAA,CAACL,SAAS,EAACyB,EAAE,CAAE,CAAEC,OAAO,CAAE,MAAM,CAAEC,cAAc,CAAE,QAAQ,CAAEC,EAAE,CAAE,CAAE,CAAE,CAAAhB,QAAA,cAClEP,IAAA,CAACN,gBAAgB,GAAE,CAAC,CACX,CAAC,CAEhB,CAEA,GAAIkB,KAAK,CAAE,CACT,mBACEZ,IAAA,CAACL,SAAS,EAACyB,EAAE,CAAE,CAAEG,EAAE,CAAE,CAAE,CAAE,CAAAhB,QAAA,cACvBP,IAAA,CAACP,KAAK,EAAC+B,QAAQ,CAAC,OAAO,CAAAjB,QAAA,cACrBP,IAAA,CAACJ,UAAU,EAAAW,QAAA,CAAEK,KAAK,CAAa,CAAC,CAC3B,CAAC,CACC,CAAC,CAEhB,CAEA,MAAO,CAAAF,aAAa,cAAGV,IAAA,CAAAE,SAAA,EAAAK,QAAA,CAAGA,QAAQ,CAAG,CAAC,CAAG,IAAI,CAC/C,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}