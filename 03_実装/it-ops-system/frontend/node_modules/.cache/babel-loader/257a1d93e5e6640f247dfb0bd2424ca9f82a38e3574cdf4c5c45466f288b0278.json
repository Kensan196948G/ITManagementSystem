{"ast":null,"code":"var _jsxFileName = \"E:\\\\IT\\u904B\\u7528\\u30B7\\u30B9\\u30C6\\u30E0\\\\03_\\u5B9F\\u88C5\\\\it-ops-system\\\\frontend\\\\src\\\\components\\\\PermissionCheck.tsx\",\n  _s = $RefreshSig$();\nimport { useState, useEffect } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { Alert, CircularProgress, Container, Typography } from '@mui/material';\nimport { useAuth } from '../contexts/AuthContext';\nimport { authApi } from '../services/api';\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nexport const PermissionCheck = ({\n  resource,\n  action,\n  children\n}) => {\n  _s();\n  const {\n    user\n  } = useAuth();\n  const navigate = useNavigate();\n  const [hasPermission, setHasPermission] = useState(null);\n  const [error, setError] = useState(null);\n  useEffect(() => {\n    const checkPermission = async () => {\n      try {\n        if (!(user !== null && user !== void 0 && user.email)) {\n          navigate('/login');\n          return;\n        }\n        const allowed = await authApi.checkPermission({\n          userEmail: user.email,\n          check: {\n            resource,\n            action\n          }\n        });\n        setHasPermission(allowed);\n        if (!allowed) {\n          setError(`${resource}への${action}権限がありません`);\n        }\n      } catch (err) {\n        setError('権限の確認中にエラーが発生しました');\n        setHasPermission(false);\n      }\n    };\n    checkPermission();\n  }, [user, resource, action, navigate]);\n  if (hasPermission === null) {\n    return /*#__PURE__*/_jsxDEV(Container, {\n      sx: {\n        display: 'flex',\n        justifyContent: 'center',\n        mt: 4\n      },\n      children: /*#__PURE__*/_jsxDEV(CircularProgress, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 52,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 51,\n      columnNumber: 7\n    }, this);\n  }\n  if (error) {\n    return /*#__PURE__*/_jsxDEV(Container, {\n      sx: {\n        mt: 4\n      },\n      children: /*#__PURE__*/_jsxDEV(Alert, {\n        severity: \"error\",\n        children: /*#__PURE__*/_jsxDEV(Typography, {\n          children: error\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 61,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 60,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 59,\n      columnNumber: 7\n    }, this);\n  }\n  return hasPermission ? /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: children\n  }, void 0, false) : null;\n};\n_s(PermissionCheck, \"5en01pBHvYUu11vQ89eSM/azx8k=\", false, function () {\n  return [useAuth, useNavigate];\n});\n_c = PermissionCheck;\nvar _c;\n$RefreshReg$(_c, \"PermissionCheck\");","map":{"version":3,"names":["useState","useEffect","useNavigate","Alert","CircularProgress","Container","Typography","useAuth","authApi","jsxDEV","_jsxDEV","Fragment","_Fragment","PermissionCheck","resource","action","children","_s","user","navigate","hasPermission","setHasPermission","error","setError","checkPermission","email","allowed","userEmail","check","err","sx","display","justifyContent","mt","fileName","_jsxFileName","lineNumber","columnNumber","severity","_c","$RefreshReg$"],"sources":["E:/IT運用システム/03_実装/it-ops-system/frontend/src/components/PermissionCheck.tsx"],"sourcesContent":["import { useState, useEffect } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { Alert, CircularProgress, Container, Typography } from '@mui/material';\r\nimport { useAuth } from '../contexts/AuthContext';\r\nimport { authApi } from '../services/api';\r\n\r\ninterface PermissionCheckProps {\r\n  resource: string;\r\n  action: 'read' | 'write';\r\n  children: React.ReactNode;\r\n}\r\n\r\nexport const PermissionCheck: React.FC<PermissionCheckProps> = ({ \r\n  resource,\r\n  action,\r\n  children \r\n}) => {\r\n  const { user } = useAuth();\r\n  const navigate = useNavigate();\r\n  const [hasPermission, setHasPermission] = useState<boolean | null>(null);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  useEffect(() => {\r\n    const checkPermission = async () => {\r\n      try {\r\n        if (!user?.email) {\r\n          navigate('/login');\r\n          return;\r\n        }\r\n\r\n        const allowed = await authApi.checkPermission({\r\n          userEmail: user.email,\r\n          check: { resource, action }\r\n        });\r\n\r\n        setHasPermission(allowed);\r\n        if (!allowed) {\r\n          setError(`${resource}への${action}権限がありません`);\r\n        }\r\n      } catch (err) {\r\n        setError('権限の確認中にエラーが発生しました');\r\n        setHasPermission(false);\r\n      }\r\n    };\r\n\r\n    checkPermission();\r\n  }, [user, resource, action, navigate]);\r\n\r\n  if (hasPermission === null) {\r\n    return (\r\n      <Container sx={{ display: 'flex', justifyContent: 'center', mt: 4 }}>\r\n        <CircularProgress />\r\n      </Container>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <Container sx={{ mt: 4 }}>\r\n        <Alert severity=\"error\">\r\n          <Typography>{error}</Typography>\r\n        </Alert>\r\n      </Container>\r\n    );\r\n  }\r\n\r\n  return hasPermission ? <>{children}</> : null;\r\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}