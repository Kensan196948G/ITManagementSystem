{"ast":null,"code":"import React,{createContext,useContext,useState,useEffect}from'react';import{authApi}from'../services/api';import{jsx as _jsx}from\"react/jsx-runtime\";const AuthContext=/*#__PURE__*/createContext({isAuthenticated:false,user:null,isLoading:true,error:null,login:async()=>({status:'error',message:'Context not initialized'}),logout:async()=>{},getCurrentUser:async()=>null});export const AuthProvider=_ref=>{let{children}=_ref;const[state,setState]=useState({isAuthenticated:Boolean(localStorage.getItem('token')),user:null,token:localStorage.getItem('token'),loading:true,error:null});useEffect(()=>{const initAuth=async()=>{const token=localStorage.getItem('token');if(!token){setState(prev=>({...prev,loading:false,isAuthenticated:false}));return;}try{const user=await authApi.getCurrentUser();setState(prev=>({...prev,user,isAuthenticated:Boolean(user),loading:false}));}catch(error){localStorage.removeItem('token');setState(prev=>({...prev,loading:false,isAuthenticated:false,user:null}));}};initAuth();},[]);const login=async credentials=>{setState(prev=>({...prev,loading:true,error:null}));try{const response=await authApi.login(credentials);if((response===null||response===void 0?void 0:response.status)==='success'&&response!==null&&response!==void 0&&response.data){const authData=response.data;setState(prev=>({...prev,isAuthenticated:true,user:{id:authData.user.id||authData.user.username,username:authData.user.username,displayName:authData.user.displayName,email:authData.user.email,roles:authData.user.roles||authData.user.groups||[]},token:authData.token,loading:false,error:null}));}else{console.warn('Unexpected response format:',response);// エラーをスローせず、最善を尽くして処理\nsetState(prev=>({...prev,loading:false,error:'ログイン情報の処理に問題が発生しました'}));}return response;}catch(error){setState(prev=>({...prev,loading:false,error:'Login failed',isAuthenticated:false,user:null,token:null}));throw error;}};const logout=async()=>{try{await authApi.logout();}finally{setState({isAuthenticated:false,user:null,token:null,loading:false,error:null});localStorage.removeItem('token');}};const getCurrentUser=async()=>{try{const user=await authApi.getCurrentUser();setState(prev=>({...prev,user,isAuthenticated:Boolean(user)}));return user;}catch(error){setState(prev=>({...prev,user:null,isAuthenticated:false}));return null;}};return/*#__PURE__*/_jsx(AuthContext.Provider,{value:{isAuthenticated:state.isAuthenticated,user:state.user,isLoading:state.loading,error:state.error,login,logout,getCurrentUser},children:children});};export const useAuth=()=>useContext(AuthContext);","map":{"version":3,"names":["React","createContext","useContext","useState","useEffect","authApi","jsx","_jsx","AuthContext","isAuthenticated","user","isLoading","error","login","status","message","logout","getCurrentUser","AuthProvider","_ref","children","state","setState","Boolean","localStorage","getItem","token","loading","initAuth","prev","removeItem","credentials","response","data","authData","id","username","displayName","email","roles","groups","console","warn","Provider","value","useAuth"],"sources":["E:/IT運用システム/03_実装/it-ops-system/frontend/src/contexts/AuthContext.tsx"],"sourcesContent":["import React, { createContext, useContext, useState, useEffect } from 'react';\r\nimport { AuthState, User, LoginFormData, ApiResponse, AuthResponse } from '../types/api';\r\nimport { authApi } from '../services/api';\r\n\r\ninterface AuthContextType {\r\n  isAuthenticated: boolean;\r\n  user: User | null;\r\n  isLoading: boolean;\r\n  error: string | null;\r\n  login: (credentials: LoginFormData) => Promise<ApiResponse<AuthResponse>>;\r\n  logout: () => Promise<void>;\r\n  getCurrentUser: () => Promise<User | null>;\r\n}\r\n\r\nconst AuthContext = createContext<AuthContextType>({\r\n  isAuthenticated: false,\r\n  user: null,\r\n  isLoading: true,\r\n  error: null,\r\n  login: async () => ({ status: 'error', message: 'Context not initialized' }),\r\n  logout: async () => {},\r\n  getCurrentUser: async () => null,\r\n});\r\n\r\nexport const AuthProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {\r\n  const [state, setState] = useState<AuthState>({\r\n    isAuthenticated: Boolean(localStorage.getItem('token')),\r\n    user: null,\r\n    token: localStorage.getItem('token'),\r\n    loading: true,\r\n    error: null,\r\n  });\r\n\r\n  useEffect(() => {\r\n    const initAuth = async () => {\r\n      const token = localStorage.getItem('token');\r\n      if (!token) {\r\n        setState(prev => ({\r\n          ...prev,\r\n          loading: false,\r\n          isAuthenticated: false,\r\n        }));\r\n        return;\r\n      }\r\n\r\n      try {\r\n        const user = await authApi.getCurrentUser();\r\n        setState(prev => ({\r\n          ...prev,\r\n          user,\r\n          isAuthenticated: Boolean(user),\r\n          loading: false,\r\n        }));\r\n      } catch (error) {\r\n        localStorage.removeItem('token');\r\n        setState(prev => ({\r\n          ...prev,\r\n          loading: false,\r\n          isAuthenticated: false,\r\n          user: null,\r\n        }));\r\n      }\r\n    };\r\n\r\n    initAuth();\r\n  }, []);\r\n\r\n  const login = async (credentials: LoginFormData) => {\r\n    setState(prev => ({ ...prev, loading: true, error: null }));\r\n    try {\r\n      const response = await authApi.login(credentials);\r\n      if (response?.status === 'success' && response?.data) {\r\n        const authData = response.data;\r\n        setState(prev => ({\r\n          ...prev,\r\n          isAuthenticated: true,\r\n          user: {\r\n            id: authData.user.id || authData.user.username,\r\n            username: authData.user.username,\r\n            displayName: authData.user.displayName,\r\n            email: authData.user.email,\r\n            roles: authData.user.roles || authData.user.groups || [],\r\n          },\r\n          token: authData.token,\r\n          loading: false,\r\n          error: null,\r\n        }));\r\n      } else {\r\n        console.warn('Unexpected response format:', response);\r\n        // エラーをスローせず、最善を尽くして処理\r\n        setState(prev => ({\r\n          ...prev,\r\n          loading: false,\r\n          error: 'ログイン情報の処理に問題が発生しました',\r\n        }));\r\n      }\r\n      return response;\r\n    } catch (error) {\r\n      setState(prev => ({\r\n        ...prev,\r\n        loading: false,\r\n        error: 'Login failed',\r\n        isAuthenticated: false,\r\n        user: null,\r\n        token: null,\r\n      }));\r\n      throw error;\r\n    }\r\n  };\r\n\r\n  const logout = async () => {\r\n    try {\r\n      await authApi.logout();\r\n    } finally {\r\n      setState({\r\n        isAuthenticated: false,\r\n        user: null,\r\n        token: null,\r\n        loading: false,\r\n        error: null,\r\n      });\r\n      localStorage.removeItem('token');\r\n    }\r\n  };\r\n\r\n  const getCurrentUser = async () => {\r\n    try {\r\n      const user = await authApi.getCurrentUser();\r\n      setState(prev => ({\r\n        ...prev,\r\n        user,\r\n        isAuthenticated: Boolean(user),\r\n      }));\r\n      return user;\r\n    } catch (error) {\r\n      setState(prev => ({\r\n        ...prev,\r\n        user: null,\r\n        isAuthenticated: false,\r\n      }));\r\n      return null;\r\n    }\r\n  };\r\n\r\n  return (\r\n    <AuthContext.Provider\r\n      value={{\r\n        isAuthenticated: state.isAuthenticated,\r\n        user: state.user,\r\n        isLoading: state.loading,\r\n        error: state.error,\r\n        login,\r\n        logout,\r\n        getCurrentUser,\r\n      }}\r\n    >\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n};\r\n\r\nexport const useAuth = () => useContext(AuthContext);\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}