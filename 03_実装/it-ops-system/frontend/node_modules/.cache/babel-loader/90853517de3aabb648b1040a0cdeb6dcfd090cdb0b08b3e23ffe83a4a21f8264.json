{"ast":null,"code":"import React,{createContext,useContext,useState,useEffect}from'react';import{authApi}from'../services/api';import{jsx as _jsx}from\"react/jsx-runtime\";const AuthContext=/*#__PURE__*/createContext({isAuthenticated:false,user:null,isLoading:true,error:null,login:async()=>({status:'error',message:'Context not initialized'}),logout:async()=>{},getCurrentUser:async()=>null});export const AuthProvider=_ref=>{let{children}=_ref;const[state,setState]=useState({isAuthenticated:false,user:null,token:null,loading:true,error:null});useEffect(()=>{const initAuth=async()=>{try{const user=await authApi.getCurrentUser();setState(prev=>({...prev,isAuthenticated:true,user,loading:false}));}catch(error){setState(prev=>({...prev,loading:false,error:'Authentication failed'}));}};initAuth();},[]);const login=async credentials=>{try{const response=await authApi.login(credentials);if(response.status==='success'&&response.data){setState(prev=>{var _response$data,_response$data2;return{...prev,isAuthenticated:true,user:(response===null||response===void 0?void 0:(_response$data=response.data)===null||_response$data===void 0?void 0:_response$data.user)||null,token:(response===null||response===void 0?void 0:(_response$data2=response.data)===null||_response$data2===void 0?void 0:_response$data2.token)||null,error:null};});}return response;}catch(error){setState(prev=>({...prev,error:'Login failed'}));throw error;}};const logout=async()=>{try{await authApi.logout();setState({isAuthenticated:false,user:null,token:null,loading:false,error:null});}catch(error){setState(prev=>({...prev,error:'Logout failed'}));}};const getCurrentUser=async()=>{try{const user=await authApi.getCurrentUser();setState(prev=>({...prev,user,isAuthenticated:true}));return user;}catch(error){setState(prev=>({...prev,user:null,isAuthenticated:false}));return null;}};return/*#__PURE__*/_jsx(AuthContext.Provider,{value:{isAuthenticated:state.isAuthenticated,user:state.user,isLoading:state.loading,error:state.error,login,logout,getCurrentUser},children:children});};export const useAuth=()=>useContext(AuthContext);","map":{"version":3,"names":["React","createContext","useContext","useState","useEffect","authApi","jsx","_jsx","AuthContext","isAuthenticated","user","isLoading","error","login","status","message","logout","getCurrentUser","AuthProvider","_ref","children","state","setState","token","loading","initAuth","prev","credentials","response","data","_response$data","_response$data2","Provider","value","useAuth"],"sources":["E:/IT運用システム/03_実装/it-ops-system/frontend/src/contexts/AuthContext.tsx"],"sourcesContent":["import React, { createContext, useContext, useState, useEffect } from 'react';\r\nimport { AuthState, User, LoginFormData, ApiResponse } from '../types/api';\r\nimport { authApi } from '../services/api';\r\n\r\ninterface AuthContextType {\r\n  isAuthenticated: boolean;\r\n  user: User | null;\r\n  isLoading: boolean;\r\n  error: string | null;\r\n  login: (credentials: LoginFormData) => Promise<ApiResponse<AuthState>>;\r\n  logout: () => Promise<void>;\r\n  getCurrentUser: () => Promise<User | null>;\r\n}\r\n\r\nconst AuthContext = createContext<AuthContextType>({\r\n  isAuthenticated: false,\r\n  user: null,\r\n  isLoading: true,\r\n  error: null,\r\n  login: async () => ({ status: 'error', message: 'Context not initialized' }),\r\n  logout: async () => {},\r\n  getCurrentUser: async () => null,\r\n});\r\n\r\nexport const AuthProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {\r\n  const [state, setState] = useState<AuthState>({\r\n    isAuthenticated: false,\r\n    user: null,\r\n    token: null,\r\n    loading: true,\r\n    error: null,\r\n  });\r\n\r\n  useEffect(() => {\r\n    const initAuth = async () => {\r\n      try {\r\n        const user = await authApi.getCurrentUser();\r\n        setState(prev => ({\r\n          ...prev,\r\n          isAuthenticated: true,\r\n          user,\r\n          loading: false,\r\n        }));\r\n      } catch (error) {\r\n        setState(prev => ({\r\n          ...prev,\r\n          loading: false,\r\n          error: 'Authentication failed',\r\n        }));\r\n      }\r\n    };\r\n\r\n    initAuth();\r\n  }, []);\r\n\r\n  const login = async (credentials: LoginFormData) => {\r\n    try {\r\n      const response = await authApi.login(credentials);\r\n      if (response.status === 'success' && response.data) {\r\n        setState(prev => ({\r\n          ...prev,\r\n          isAuthenticated: true,\r\n          user: response?.data?.user || null,\r\n          token: response?.data?.token || null,\r\n          error: null,\r\n        }));\r\n      }\r\n      return response;\r\n    } catch (error) {\r\n      setState(prev => ({\r\n        ...prev,\r\n        error: 'Login failed',\r\n      }));\r\n      throw error;\r\n    }\r\n  };\r\n\r\n  const logout = async () => {\r\n    try {\r\n      await authApi.logout();\r\n      setState({\r\n        isAuthenticated: false,\r\n        user: null,\r\n        token: null,\r\n        loading: false,\r\n        error: null,\r\n      });\r\n    } catch (error) {\r\n      setState(prev => ({\r\n        ...prev,\r\n        error: 'Logout failed',\r\n      }));\r\n    }\r\n  };\r\n\r\n  const getCurrentUser = async () => {\r\n    try {\r\n      const user = await authApi.getCurrentUser();\r\n      setState(prev => ({\r\n        ...prev,\r\n        user,\r\n        isAuthenticated: true,\r\n      }));\r\n      return user;\r\n    } catch (error) {\r\n      setState(prev => ({\r\n        ...prev,\r\n        user: null,\r\n        isAuthenticated: false,\r\n      }));\r\n      return null;\r\n    }\r\n  };\r\n\r\n  return (\r\n    <AuthContext.Provider\r\n      value={{\r\n        isAuthenticated: state.isAuthenticated,\r\n        user: state.user,\r\n        isLoading: state.loading,\r\n        error: state.error,\r\n        login,\r\n        logout,\r\n        getCurrentUser,\r\n      }}\r\n    >\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n};\r\n\r\nexport const useAuth = () => useContext(AuthContext);"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}