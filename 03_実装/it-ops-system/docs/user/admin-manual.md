# 管理者向けマニュアル: Graph APIパーミッション管理

## 概要

本マニュアルは、IT運用システムにおけるGraph APIパーミッション管理機能の使用方法を説明します。このシステムは、ISO 20000（ITサービスマネジメント）およびISO 27001（情報セキュリティマネジメント）の要件に準拠して設計されています。

## バージョン情報

- マニュアルバージョン: 1.0.0
- 最終更新日: 2025年3月8日
- 対応システムバージョン: 1.0.0

## 前提条件

- グローバル管理者権限を持つアカウント
- Microsoft 365管理者アカウント（Graph API連携用）
- ウェブブラウザ（Chrome, Firefox, Edge最新版推奨）

## ログイン方法

1. ブラウザでIT運用システムにアクセス: `https://[your-domain]/`
2. ログイン画面で管理者アカウントの認証情報を入力
3. 必要に応じて多要素認証を完了

![ログイン画面](../images/admin-login.png)

## 管理者ダッシュボード

ログイン後、管理者ダッシュボードが表示されます。ダッシュボードには以下の主要セクションがあります：

- **概要**: システム全体の状態と重要な指標
- **パーミッション管理**: Graph APIパーミッション管理機能
- **ユーザー管理**: ユーザーアカウント管理
- **システムステータス**: システムリソースとアラート
- **監査ログ**: 操作履歴と監査情報

![管理者ダッシュボード](../images/admin-dashboard.png)

## Graph APIパーミッション管理

### パーミッション管理画面へのアクセス

1. 左側のナビゲーションメニューから「パーミッション管理」を選択
2. 「Graph APIパーミッション」タブを選択

![パーミッション管理画面](../images/permission-management.png)

### ユーザーのパーミッション確認

1. パーミッション管理画面で「ユーザー検索」フィールドにユーザーのメールアドレスを入力
2. 検索ボタンをクリック
3. ユーザーの現在のGraph APIパーミッション一覧が表示されます

![ユーザーパーミッション一覧](../images/user-permissions.png)

### パーミッションの付与

1. ユーザーのパーミッション一覧画面で「パーミッション付与」ボタンをクリック
2. パーミッション付与ダイアログが表示されます
3. 付与するパーミッションを選択:
   - **パーミッション**: ドロップダウンリストから付与するパーミッションを選択
   - **スコープ**: 「Delegated」または「Application」を選択
4. 「付与」ボタンをクリック
5. 確認ダイアログで「はい」をクリック

![パーミッション付与](../images/grant-permission.png)

### パーミッションの削除

1. ユーザーのパーミッション一覧から削除するパーミッションの行で「削除」ボタンをクリック
2. 確認ダイアログが表示されます
3. 「削除」ボタンをクリック

![パーミッション削除](../images/revoke-permission.png)

### 一括パーミッション管理

複数のユーザーに対して同じパーミッションを一括で管理する場合：

1. パーミッション管理画面で「一括操作」タブを選択
2. 操作タイプ（付与/削除）を選択
3. 対象ユーザーを選択:
   - CSVファイルをアップロード
   - または手動でメールアドレスを入力（複数の場合は改行またはカンマ区切り）
4. パーミッションとスコープを選択
5. 「実行」ボタンをクリック
6. 確認ダイアログで「はい」をクリック

![一括パーミッション管理](../images/bulk-permission.png)

### パーミッション監査ログの確認

1. パーミッション管理画面で「監査ログ」タブを選択
2. 以下のフィルターを使用して監査ログを絞り込み:
   - **期間**: 開始日と終了日
   - **ユーザー**: 特定のユーザーに関する操作
   - **操作タイプ**: 付与/削除
   - **パーミッション**: 特定のパーミッション
3. 「検索」ボタンをクリック

![監査ログ](../images/audit-logs.png)

### 監査レポートの生成

1. 監査ログ画面で「レポート生成」ボタンをクリック
2. レポート形式（PDF/CSV/Excel）を選択
3. 「ダウンロード」ボタンをクリック

![監査レポート](../images/audit-report.png)

## ITSMプロセス統合

ISO 20000に準拠したITサービスマネジメントプロセスとの統合：

### 変更管理プロセス

重要なパーミッション変更は変更管理プロセスに従って実施してください：

1. 変更要求（CR）を作成
2. 変更諮問委員会（CAB）の承認を取得
3. システムでパーミッション変更を実施
4. 変更記録を更新

### インシデント管理連携

セキュリティアラートが発生した場合：

1. アラート詳細を確認
2. インシデント管理システムでインシデントを作成
3. インシデントIDを監査ログに記録

### 構成管理連携

パーミッション変更は構成管理データベース（CMDB）と連携します：

1. パーミッション変更後、CMDBの構成項目（CI）が自動的に更新されます
2. CMDB上でパーミッション構成を確認できます

## セキュリティ管理

ISO 27001に準拠したセキュリティ管理：

### アクセス制御

- 定期的にユーザーのパーミッションをレビュー
- 不要なパーミッションは速やかに削除
- 最小権限の原則に従ってパーミッションを付与

### 監査とモニタリング

- 定期的に監査ログをレビュー
- 不審なパーミッション変更を調査
- セキュリティインシデントの早期発見

### インシデント対応

セキュリティインシデントが発生した場合：

1. 影響を受けるパーミッションを特定
2. 必要に応じてパーミッションを一時的に削除
3. インシデント対応チームに通知
4. インシデント対応計画に従って対応

## トラブルシューティング

### 一般的な問題と解決方法

| 問題 | 考えられる原因 | 解決方法 |
|------|--------------|----------|
| パーミッション付与に失敗 | Graph API接続エラー | 接続設定を確認、再試行 |
| ユーザーが見つからない | ユーザーが存在しない | Azure ADでユーザーを確認 |
| 監査ログが表示されない | フィルター設定の問題 | フィルターをリセットして再試行 |
| 一括操作が失敗 | CSVフォーマットエラー | CSVフォーマットを確認、修正 |

### エラーコードと対応

| エラーコード | 説明 | 対応方法 |
|------------|------|----------|
| GRAPH_API_ERROR | Graph API接続エラー | ネットワーク接続とAPI設定を確認 |
| PERMISSION_NOT_FOUND | パーミッションが存在しない | パーミッション名を確認 |
| USER_NOT_FOUND | ユーザーが存在しない | ユーザーIDを確認 |
| INSUFFICIENT_PRIVILEGE | 権限不足 | 管理者権限を確認 |

### サポート連絡先

問題が解決しない場合は、以下の連絡先にお問い合わせください：

- **IT運用サポートデスク**: support@example.com
- **緊急連絡先**: 03-1234-5678（平日9:00-18:00）

## ベストプラクティス

### パーミッション管理

- 最小権限の原則に従ってパーミッションを付与
- 定期的にパーミッションをレビュー（四半期ごと推奨）
- 不要なパーミッションは速やかに削除
- パーミッション変更は文書化し、承認を得る

### セキュリティ

- 管理者アカウントは多要素認証を有効化
- 共有アカウントでの管理操作を避ける
- 定期的にパスワードを変更
- 監査ログを定期的にレビュー

### コンプライアンス

- パーミッション変更は変更管理プロセスに従う
- 監査証跡を保持（最低1年間）
- 定期的にコンプライアンスレポートを生成
- 規制要件に従ってデータを保護

## 付録

### 用語集

| 用語 | 説明 |
|------|------|
| Graph API | Microsoft Graph API - Microsoft 365サービスへのアクセスを提供するAPI |
| Delegated Permission | ユーザーの代わりにアプリがAPIにアクセスする権限 |
| Application Permission | ユーザーなしでアプリがAPIにアクセスする権限 |
| ITSM | ITサービスマネジメント |
| CMDB | 構成管理データベース |
| CAB | 変更諮問委員会 |

### 関連ドキュメント

- [システムアーキテクチャ設計書](../architecture/system-architecture.md)
- [API仕様書](../api/api-specification.md)
- [トラブルシューティングガイド](./troubleshooting-guide.md)
- [Microsoft Graph APIドキュメント](https://docs.microsoft.com/graph)

## 変更履歴

| 日付 | バージョン | 変更内容 |
|------|------------|----------|
| 2025-03-08 | 1.0.0 | 初版リリース |